<div class="card card-outline card-primary">
    <div class="card-header"><h3 class="card-title">编辑管理员</h3></div>
    <div class="card-body">
        <form id="form-edit" method="post" class="form-horizontal">
            <input type="hidden" name="id" value="{$data.id|default=0}">
            <div class="form-group row">
                <label class="col-sm-2 col-form-label">账号</label>
                <div class="col-sm-6"><input type="text" name="username" class="form-control" value="{$data.username|default=''}" readonly></div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label">密码</label>
                <div class="col-sm-6"><input type="password" name="password" class="form-control" placeholder="留空不修改"></div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label">昵称</label>
                <div class="col-sm-6"><input type="text" name="nickname" class="form-control" value="{$data.nickname|default=''}"></div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label">父级管理员</label>
                <div class="col-sm-6">
                    <select name="pid" class="form-control">
                        <option value="0">无（顶级）</option>
                        {volist name="parents" id="p"}
                        <option value="{$p.id}" {if condition="$data.pid == $p.id"}selected{/if}>{$p.username}（{$p.nickname|default='-'}）</option>
                        {/volist}
                    </select>
                </div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label">数据权限</label>
                <div class="col-sm-6">
                    <select name="data_scope" class="form-control">
                        <option value="1" {if condition="$data.data_scope == 1"}selected{/if}>个人（仅自己）</option>
                        <option value="2" {if condition="$data.data_scope == 2"}selected{/if}>子级（自己+下级）</option>
                        <option value="3" {if condition="$data.data_scope == 3"}selected{/if}>全部</option>
                    </select>
                </div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label">角色</label>
                <div class="col-sm-6">
                    <select name="role_ids" class="form-control">
                        <option value="">请选择</option>
                        {volist name="roles" id="r"}
                        <option value="{$r.id}" {if condition="$data.role_ids == $r.id"}selected{/if}>{$r.name}</option>
                        {/volist}
                    </select>
                </div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label">状态</label>
                <div class="col-sm-6">
                    <select name="status" class="form-control">
                        <option value="1" {if condition="$data.status == 1"}selected{/if}>正常</option>
                        <option value="0" {if condition="$data.status == 0"}selected{/if}>禁用</option>
                    </select>
                </div>
            </div>
            <div class="form-group row">
                <div class="col-sm-6 offset-sm-2">
                    <button type="submit" class="btn btn-primary">保存</button>
                    <a href="{:url('admin/index')}" class="btn btn-default ml-2">返回</a>
                </div>
            </div>
        </form>
    </div>
</div>
<script>
(function() {
    function initForm() {
        if (typeof jQuery === 'undefined') {
            setTimeout(initForm, 50);
            return;
        }
        var $ = jQuery;
        var base = (typeof Config !== 'undefined' && Config.moduleurl) ? Config.moduleurl : '';
        $('#form-edit').attr('action', base + '/admin/edit');
        $('#form-edit').on('submit', function (e) {
            e.preventDefault();
            $.post($(this).attr('action'), $(this).serialize(), function (r) {
                if (r && r.msg) {
                    alert(r.msg);
                }
                if (r && r.code === 1) {
                    var redirectUrl = (typeof Config !== 'undefined' && Config.table_index_url) ? Config.table_index_url : (base + '/admin/index');
                    location.href = redirectUrl;
                }
            }, 'json').fail(function(xhr) {
                try {
                    var r = JSON.parse(xhr.responseText);
                    alert(r.msg || '操作失败');
                } catch(e) {
                    alert('操作失败');
                }
            });
        });
    }
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initForm);
    } else {
        initForm();
    }
})();
</script>
