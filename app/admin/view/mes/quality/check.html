<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">质检记录管理</h3>
                <div class="card-tools">
                    <form id="form-search" class="form-inline" action="{:url('mes/quality/check')}" method="get">
                        <div class="input-group input-group-sm" style="width: 250px;">
                            <input type="text" name="search" class="form-control float-right" placeholder="搜索">
                            <div class="input-group-append">
                                <button type="submit" class="btn btn-default"><i class="fas fa-search"></i></button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <!-- /.card-header -->
            <div class="card-body table-responsive p-0">
                <table id="table" class="table table-bordered table-hover">
                    <thead>
                        <tr>
                            <th><input type="checkbox" name="ids" value="" id="checkall" /></th>
                            <th>质检编号</th>
                            <th>报工记录</th>
                            <th>质检标准</th>
                            <th>质检数量</th>
                            <th>合格数量</th>
                            <th>不合格数量</th>
                            <th>合格率</th>
                            <th>质检日期</th>
                            <th>状态</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
            <!-- /.card-body -->
            <div class="card-footer">
                <div id="pagination" class="float-right"></div>
            </div>
        </div>
        <!-- /.card -->
    </div>
</div>

<script>
$(function() {
    var table = $('#table');
    if (typeof table.bootstrapTable !== 'function' || table.data('bootstrap.table')) {
        return;
    }
    // 初始化表格
    table.bootstrapTable({
        url: '{:url("mes/quality/check")}',
        method: 'get',
        pagination: true,
        sidePagination: 'server',
        pageSize: 20,
        pageList: [10, 20, 50, 100],
        search: false,
        showRefresh: true,
        showColumns: true,
        columns: [
            {
                checkbox: true
            },
            {
                field: 'check_no',
                title: '质检编号',
                align: 'center'
            },
            {
                field: 'report_id',
                title: '报工记录',
                align: 'center',
                formatter: function(value, row, index) {
                    return row.report ? row.report.report_no : '-';
                }
            },
            {
                field: 'standard_id',
                title: '质检标准',
                align: 'center',
                formatter: function(value, row, index) {
                    return row.standard ? row.standard.name : '-';
                }
            },
            {
                field: 'check_quantity',
                title: '质检数量',
                align: 'center'
            },
            {
                field: 'qualified_quantity',
                title: '合格数量',
                align: 'center'
            },
            {
                field: 'unqualified_quantity',
                title: '不合格数量',
                align: 'center'
            },
            {
                field: 'qualified_rate',
                title: '合格率',
                align: 'center',
                formatter: function(value, row, index) {
                    return value + '%';
                }
            },
            {
                field: 'check_time',
                title: '质检日期',
                align: 'center',
                formatter: function(value, row, index) {
                    return value ? new Date(value * 1000).toLocaleString() : '-';
                }
            },
            {
                field: 'status',
                title: '状态',
                align: 'center',
                formatter: function(value, row, index) {
                    switch(value) {
                        case 1:
                            return '<span class="badge badge-success">合格</span>';
                        case 2:
                            return '<span class="badge badge-danger">不合格</span>';
                        default:
                            return '<span class="badge badge-secondary">待质检</span>';
                    }
                }
            },
            {
                field: 'id',
                title: '操作',
                align: 'center',
                formatter: function(value, row, index) {
                    var html = '';
                    html += '<a href="{:url("mes/quality/addCheck")}?report_id=' + row.report_id + '" class="btn btn-xs btn-primary" title="详情"><i class="fas fa-eye"></i></a> ';
                    return html;
                }
            }
        ],
        responseHandler: function(res) {
            return {
                "total": res.data.total,
                "rows": res.data.list
            };
        },
        onLoadError: function() {
            alert('加载失败，请重试');
        }
    });

    // 全选/取消全选
    $(document).off('click', '#checkall').on('click', '#checkall', function() {
        $('#table').bootstrapTable('togglePagination');
    });

    // 搜索表单提交
    $(document).off('submit', '#form-search').on('submit', '#form-search', function(e) {
        return true;
    });
});
</script>
