<div class="card panel-intro">
    <div class="card-header">
        <div class="panel-lead"><em>成本分析报表</em> 统计订单成本数据</div>
    </div>
    <div class="card-body">
        <div class="row mb-3">
            <div class="col-md-4">
                <input type="date" class="form-control" id="start_date" value="{php}echo date('Y-m-01');{/php}">
            </div>
            <div class="col-md-4">
                <input type="date" class="form-control" id="end_date" value="{php}echo date('Y-m-d');{/php}">
            </div>
            <div class="col-md-4">
                <button type="button" class="btn btn-primary" id="btn-query">查询</button>
            </div>
        </div>
        <table id="table" class="table table-striped table-bordered table-hover" width="100%"></table>
    </div>
</div>

<script>
(function() {
    var base = (typeof Config !== 'undefined' && Config.moduleurl) ? Config.moduleurl : '';
    var table = $('#table');
    
    function loadTable() {
        var startDate = $('#start_date').val();
        var endDate = $('#end_date').val();
        
        table.bootstrapTable('destroy').bootstrapTable({
            url: base + '/mes/bi/costAnalysis?start_date=' + startDate + '&end_date=' + endDate,
            pk: 'id',
            sortName: 'id',
            sortOrder: 'desc',
            columns: [
                {field: 'order_no', title: '订单号', align: 'left'},
                {field: 'order_name', title: '订单名称', align: 'left'},
                {field: 'material_cost', title: '物料成本', width: 120, align: 'right', formatter: function(value) {
                    return '¥' + parseFloat(value || 0).toFixed(2);
                }},
                {field: 'labor_cost', title: '人工成本', width: 120, align: 'right', formatter: function(value) {
                    return '¥' + parseFloat(value || 0).toFixed(2);
                }},
                {field: 'total_cost', title: '总成本', width: 150, align: 'right', formatter: function(value) {
                    return '<span class="text-danger font-weight-bold">¥' + parseFloat(value || 0).toFixed(2) + '</span>';
                }}
            ]
        });
    }
    
    $('#btn-query').on('click', function() {
        loadTable();
    });
    
    // 初始加载
    loadTable();
})();
</script>
